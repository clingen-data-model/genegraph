prefix gci: <http://dataexchange.clinicalgenome.org/gci/>
prefix gcixform: <http://dataexchange.clinicalgenome.org/gcixform/>
prefix ga4gh: <https://terms.ga4gh.org/>

construct
{

  ?vd a ga4gh:VariationDescriptor ;
  :ga4gh/CanonicalReference ?canonical_reference ;
  :skos/preferred-label ?preferred_label . 

}
where
{
  
  ?vd a gci:variant ;


  OPTIONAL {
    ?vd gci:canonicalTranscriptTitle ?canonicalTranscriptTitle .
  }

  OPTIONAL {
    ?vd gci:maneTranscriptTitle ?maneTranscriptTitle .
  }

  OPTIONAL {
    ?vd gci:preferredTitle ?preferredTitle .
  }

  OPTIONAL {
    ?vd gci:clinvarVariantTitle ?clinvarVariantTitle .
  }
  
  OPTIONAL {
    ?vd gci:carId ?caIdstr .

    BIND(IRI(CONCAT(?arbase, ?caIdstr)) AS ?caid) .
  }

  OPTIONAL {
    ?vd gci:clinvarVariantId ?cvIdstr .

    BIND(IRI(CONCAT(?cvbase, ?cvIdstr)) AS ?cvId) .
  }

  BIND(COALESCE(?caid, ?cvId) AS ?canonical_reference) .
  
  BIND(COALESCE(?canonicalTranscriptTitle,
		?maneTranscriptTitle,
		?preferredTitle,
		?clinvarVariantTitle) AS ?preferred_label ) .
}
